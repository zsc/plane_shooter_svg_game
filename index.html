<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ°‘é£æœºå¤§æˆ˜</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Microsoft YaHei', sans-serif;
            position: relative;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(to bottom, #001a33, #003366);
        }
        #debugInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #0f0;
            font-size: 12px;
            font-family: monospace;
            background: rgba(0,0,0,0.7);
            padding: 5px;
            display: none;
            z-index: 1000;
        }
        #debugInfo.show {
            display: block;
        }
        
        /* å¼€å§‹æŒ‰é’®æ ·å¼ */
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 60px;
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid #FFD700;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
            z-index: 100;
            animation: pulse 2s infinite;
        }
        
        #startButton:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.8);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        #startButton:active {
            transform: translate(-50%, -50%) scale(0.95);
        }
        
        #startButton.hidden {
            display: none;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            }
            50% {
                box-shadow: 0 4px 25px rgba(255, 215, 0, 0.8);
            }
            100% {
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
            }
        }
        
        /* æ§åˆ¶æç¤º */
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #888;
            font-size: 14px;
            text-align: center;
            z-index: 50;
        }
        
        #controls.hidden {
            display: none;
        }
        
        /* éŸ³é¢‘æ§åˆ¶é¢æ¿ */
        #audioControls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            z-index: 100;
            min-width: 200px;
        }
        
        #audioControls h3 {
            margin: 0 0 10px 0;
            color: #FFD700;
            font-size: 16px;
            text-align: center;
        }
        
        .audio-control {
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .audio-control label {
            color: #00FF00;
            margin-right: 10px;
        }
        
        .audio-control input[type="range"] {
            width: 100px;
            cursor: pointer;
        }
        
        .audio-control span {
            color: #FFD700;
            min-width: 40px;
            text-align: right;
        }
        
        .audio-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .audio-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.5);
        }
        
        .audio-button.muted {
            background: linear-gradient(135deg, #FF6B6B 0%, #C44569 100%);
        }
        
        #audioControls.hidden {
            display: none;
        }
        
        .keyboard-hint {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444;
            font-size: 12px;
            color: #888;
        }
        
        .keyboard-hint div {
            margin: 3px 0;
        }
        
        .key {
            color: #FFD700;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" tabindex="0"></canvas>
    <div id="debugInfo"></div>
    
    <!-- å¼€å§‹æŒ‰é’® -->
    <button id="startButton">å¼€å§‹æ¸¸æˆ</button>
    
    <!-- æš‚åœæŒ‰é’®ï¼ˆæ¸¸æˆä¸­æ˜¾ç¤ºï¼‰ -->
    <button id="pauseButton" class="hidden" style="
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        font-size: 16px;
        background: rgba(0,0,0,0.7);
        color: #FFD700;
        border: 2px solid #FFD700;
        border-radius: 5px;
        cursor: pointer;
        z-index: 100;
    ">æš‚åœ</button>
    
    <!-- æ§åˆ¶æç¤º -->
    <div id="controls">
        <p>æ–¹å‘é”®/WASD: ç§»åŠ¨ | 1/2/3: åˆ‡æ¢æˆ˜æœº | Tab: åˆ‡æ¢æ­¦å™¨ | ç©ºæ ¼: ç‚¸å¼¹</p>
        <p>ESC: æš‚åœ | F3: è°ƒè¯•æ¨¡å¼ | M: é™éŸ³ | -/+: éŸ³é‡</p>
    </div>
    
    <!-- éŸ³é¢‘æ§åˆ¶é¢æ¿ -->
    <div id="audioControls">
        <h3>ğŸµ éŸ³é¢‘æ§åˆ¶</h3>
        
        <div class="audio-control">
            <label>éŸ³ä¹:</label>
            <input type="range" id="musicVolume" min="0" max="100" value="50">
            <span id="musicVolumeText">50%</span>
        </div>
        
        <div class="audio-control">
            <label>éŸ³æ•ˆ:</label>
            <input type="range" id="sfxVolume" min="0" max="100" value="50">
            <span id="sfxVolumeText">50%</span>
        </div>
        
        <button id="muteButton" class="audio-button">é™éŸ³</button>
        
        <div class="keyboard-hint">
            <div><span class="key">M</span> - é™éŸ³åˆ‡æ¢</div>
            <div><span class="key">-/+</span> - éŸ³é‡è°ƒèŠ‚</div>
        </div>
    </div>
    
    <script src="js/core/GameConfig.js"></script>
    <script src="js/core/GameLoop.js"></script>
    <script src="js/core/StateMachine.js"></script>
    <script src="js/assets/AssetManager.js"></script>
    <script src="js/render/Renderer.js"></script>
    <script src="js/input/InputManager.js"></script>
    <script src="js/entities/Player.js"></script>
    <script src="js/entities/Enemy.js"></script>
    <script src="js/combat/Weapon.js"></script>
    <script src="js/combat/BulletSystem.js"></script>
    <script src="js/combat/CollisionSystem.js"></script>
    <script src="js/effects/ParticleSystem.js"></script>
    <script src="js/audio/AudioManager.js"></script>
    <!-- Phase 3: Level Content -->
    <script src="js/levels/LevelManager.js"></script>
    <script src="js/levels/WaveManager.js"></script>
    <script src="js/boss/Boss.js"></script>
    <script src="js/boss/BossManager.js"></script>
    <script src="js/powerups/PowerUp.js"></script>
    <script src="js/powerups/PowerUpManager.js"></script>
    <script src="js/Game.js"></script>
    <script>
        let game;
        
        // æ¸¸æˆåˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            game = new Game();
            game.init();
            game.start();
            
            // è·å–å…ƒç´ 
            const startButton = document.getElementById('startButton');
            const pauseButton = document.getElementById('pauseButton');
            const controls = document.getElementById('controls');
            
            // å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            startButton.addEventListener('click', () => {
                // éšè—æŒ‰é’®å’Œæç¤º
                startButton.classList.add('hidden');
                controls.classList.add('hidden');
                
                // æ ¹æ®å½“å‰æ–‡å­—å†³å®šè¡Œä¸º
                if (startButton.textContent === 'é‡æ–°å¼€å§‹') {
                    game.player.reset();
                    game.stateMachine.changeState(GameConfig.STATES.MENU);
                    startButton.textContent = 'å¼€å§‹æ¸¸æˆ';
                } else {
                    // åˆ‡æ¢åˆ°æ¸¸æˆçŠ¶æ€
                    game.stateMachine.changeState(GameConfig.STATES.PLAYING);
                }
                
                // èšç„¦ç”»å¸ƒä»¥æ¥æ”¶é”®ç›˜è¾“å…¥
                document.getElementById('gameCanvas').focus();
            });
            
            // æš‚åœæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            pauseButton.addEventListener('click', () => {
                const currentState = game.stateMachine.getCurrentStateName();
                if (currentState === GameConfig.STATES.PLAYING) {
                    game.stateMachine.changeState(GameConfig.STATES.PAUSED);
                    pauseButton.textContent = 'ç»§ç»­';
                } else if (currentState === GameConfig.STATES.PAUSED) {
                    game.stateMachine.changeState(GameConfig.STATES.PLAYING);
                    pauseButton.textContent = 'æš‚åœ';
                }
                document.getElementById('gameCanvas').focus();
            });
            
            // ç›‘å¬çŠ¶æ€å˜åŒ–ï¼Œæ˜¾ç¤º/éšè—æŒ‰é’®
            game.stateMachine.onStateChange((newState) => {
                if (newState === GameConfig.STATES.MENU) {
                    startButton.textContent = 'å¼€å§‹æ¸¸æˆ';
                    startButton.classList.remove('hidden');
                    controls.classList.remove('hidden');
                    pauseButton.classList.add('hidden');
                } else if (newState === GameConfig.STATES.PLAYING) {
                    startButton.classList.add('hidden');
                    controls.classList.add('hidden');
                    pauseButton.classList.remove('hidden');
                    pauseButton.textContent = 'æš‚åœ';
                } else if (newState === GameConfig.STATES.PAUSED) {
                    pauseButton.textContent = 'ç»§ç»­';
                } else if (newState === GameConfig.STATES.GAME_OVER) {
                    // æ¸¸æˆç»“æŸæ—¶æ˜¾ç¤ºé‡æ–°å¼€å§‹æŒ‰é’®
                    startButton.textContent = 'é‡æ–°å¼€å§‹';
                    startButton.classList.remove('hidden');
                    pauseButton.classList.add('hidden');
                }
            });
            
            // éŸ³é¢‘æ§åˆ¶åˆå§‹åŒ–
            const musicVolumeSlider = document.getElementById('musicVolume');
            const musicVolumeText = document.getElementById('musicVolumeText');
            const sfxVolumeSlider = document.getElementById('sfxVolume');
            const sfxVolumeText = document.getElementById('sfxVolumeText');
            const muteButton = document.getElementById('muteButton');
            
            // éŸ³ä¹éŸ³é‡æ§åˆ¶
            musicVolumeSlider.addEventListener('input', (e) => {
                const volume = e.target.value / 100;
                if (window.audioManager) {
                    window.audioManager.setMusicVolume(volume);
                    musicVolumeText.textContent = `${e.target.value}%`;
                }
            });
            
            // éŸ³æ•ˆéŸ³é‡æ§åˆ¶
            sfxVolumeSlider.addEventListener('input', (e) => {
                const volume = e.target.value / 100;
                if (window.audioManager) {
                    window.audioManager.setSfxVolume(volume);
                    sfxVolumeText.textContent = `${e.target.value}%`;
                }
            });
            
            // é™éŸ³æŒ‰é’®
            muteButton.addEventListener('click', () => {
                if (window.audioManager) {
                    const muted = window.audioManager.toggleMute();
                    muteButton.textContent = muted ? 'å–æ¶ˆé™éŸ³' : 'é™éŸ³';
                    muteButton.classList.toggle('muted', muted);
                }
            });
            
            // ç»Ÿä¸€çš„é”®ç›˜äº‹ä»¶å¤„ç†å™¨ - æ‰€æœ‰é”®ç›˜è¾“å…¥çš„å•ä¸€å…¥å£
            window.addEventListener('keydown', (e) => {
                // è·å–å½“å‰æ¸¸æˆçŠ¶æ€
                const isPlaying = game && game.stateMachine && 
                    game.stateMachine.getCurrentStateName() === GameConfig.STATES.PLAYING;
                
                // ä¼˜å…ˆå¤„ç†UIæ§åˆ¶ï¼ˆè¿™äº›åœ¨ä»»ä½•çŠ¶æ€ä¸‹éƒ½åº”è¯¥å·¥ä½œï¼‰
                
                // éŸ³é‡æ§åˆ¶å¿«æ·é”®
                if (e.key === 'm' || e.key === 'M') {
                    muteButton.click();
                    return;
                } else if (e.key === '-' || e.key === '_') {
                    const currentVolume = parseInt(musicVolumeSlider.value);
                    const newVolume = Math.max(0, currentVolume - 10);
                    musicVolumeSlider.value = newVolume;
                    sfxVolumeSlider.value = newVolume;
                    musicVolumeSlider.dispatchEvent(new Event('input'));
                    sfxVolumeSlider.dispatchEvent(new Event('input'));
                    return;
                } else if (e.key === '=' || e.key === '+') {
                    const currentVolume = parseInt(musicVolumeSlider.value);
                    const newVolume = Math.min(100, currentVolume + 10);
                    musicVolumeSlider.value = newVolume;
                    sfxVolumeSlider.value = newVolume;
                    musicVolumeSlider.dispatchEvent(new Event('input'));
                    sfxVolumeSlider.dispatchEvent(new Event('input'));
                    return;
                }
                
                // è°ƒè¯•æ¨¡å¼åˆ‡æ¢
                if (e.key === 'F3') {
                    e.preventDefault();
                    document.getElementById('debugInfo').classList.toggle('show');
                    return;
                }
                
                // Enteré”®å¿«é€Ÿå¼€å§‹ï¼ˆä»…åœ¨èœå•æ—¶ï¼‰
                if (e.key === 'Enter' && !startButton.classList.contains('hidden')) {
                    startButton.click();
                    return;
                }
                
                // æ¸¸æˆè¿›è¡Œä¸­çš„æ§åˆ¶
                if (isPlaying && game) {
                    // æˆ˜æœºåˆ‡æ¢ (1/2/3)
                    if (e.key === '1') {
                        console.log('åˆ‡æ¢åˆ°æˆ˜æ–—æœº');
                        game.switchAircraft('fighter');
                        e.preventDefault();
                    } else if (e.key === '2') {
                        console.log('åˆ‡æ¢åˆ°è½°ç‚¸æœº');
                        game.switchAircraft('bomber');
                        e.preventDefault();
                    } else if (e.key === '3') {
                        console.log('åˆ‡æ¢åˆ°æ‹¦æˆªæœº');
                        game.switchAircraft('interceptor');
                        e.preventDefault();
                    } 
                    // ç©ºæ ¼é”®æ”¾ç‚¸å¼¹
                    else if (e.key === ' ' || e.code === 'Space') {
                        console.log('ä½¿ç”¨ç‚¸å¼¹');
                        game.triggerBomb();
                        e.preventDefault();
                    }
                    // Tabåˆ‡æ¢æ­¦å™¨
                    else if (e.key === 'Tab') {
                        console.log('åˆ‡æ¢æ­¦å™¨');
                        if (game.player && game.player.weaponManager) {
                            game.player.weaponManager.switchWeapon();
                            game.showMessage = `æ­¦å™¨: ${game.player.weaponManager.getCurrentWeaponName()}`;
                            game.messageTimer = 60;
                        }
                        e.preventDefault();
                    }
                    // ESCæš‚åœ
                    else if (e.key === 'Escape') {
                        console.log('æš‚åœæ¸¸æˆ');
                        game.stateMachine.changeState(GameConfig.STATES.PAUSED);
                        e.preventDefault();
                    }
                    
                    // ç§»åŠ¨æ§åˆ¶ä»ç”±InputManagerå¤„ç†ï¼ˆå› ä¸ºéœ€è¦æŒç»­æŒ‰é”®æ£€æµ‹ï¼‰
                    // Arrow keys and WASD are handled by InputManager
                }
            });
        });
    </script>
</body>
</html>